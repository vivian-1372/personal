---
title: 'Data Exploration: Making Decisions'
author: "Vivian Nguyen"
date: "September 9, 2021"
output:
  html_document:
    df_print: paged
  pdf_document: default
urlcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(readr)
library(ggplot2)
library(estimatr) # difference_in_means()
library(tidyverse)
library(descr)

```

In this Data Exploration assignment, you have two separate data sets with which you will work. The first involves the data generated by you and your classmates last week when you took the in-class survey. The second involves some of the data used in the Atkinson et al. (2009) piece that you read for class this week. Both data sets are described in more detail below.

If you have a question about any part of this assignment, please ask! Note that the actionable part of each question is **bolded**.

# Part 1: Cognitive Biases

You may have noticed that the questions on the survey you took during class last week were based on the Kahneman (2003) reading you did for this week. The goal for this set of questions is to examine those data to see if you and your classmates exhibit the same cognitive biases that Kahneman wrote about. The data you generated is described below.

**Data Details:**

* File Name: \texttt{bias\_data.csv}

* Source: These data are from the in-class survey you took last week. 

Variable Name         | Variable Description
--------------------- | --------------------------------------
\texttt{id}         | Unique ID for each respondent
\texttt{rare\_disease\_prog}  | From the rare disease problem, the program chosen by the respondent (either 'Program A' or 'Program B')
\texttt{rare\_disease\_cond}  | From the rare disease problem, the framing condition to which the respondent was assigned (either 'save' or 'die')
\texttt{linda}  | From the Linda problem, the option the respondent thought most probable, either "teller" or "teller and feminist"
\texttt{cab}  | From the cab problem, the respondent's estimate of the probability the car was blue
\texttt{gender}  | One of "man", "woman", "non-binary", or "other"
\texttt{year}  | Year at Harvard
\texttt{college\_stats}  | Indicator for whether or not the respondent has taken a college-level statistics course

Before you get started, make sure you replace "file_name_here_1.csv" with the name of the file. (Also, remember to make sure you have saved the .Rmd version of this file and the file with the data in the same folder.)
```{r biases, message = FALSE}
# load the class-generated bias data
bias_data <- read_csv("bias_data.csv")
```

## Question 1
First, let's look at the rare disease problem. You'll recall from the Kahneman (2003) piece that responses to this problem often differ based on the framing (people being saved versus people dying), despite the fact that the two frames are logically equivalent. This is what is called a 'framing bias'.

**Did you all exhibit this bias? Since the outcomes for this problem are binary, we need to test to see if the proportions who chose Program A under each of the conditions are the same. Report the difference in proportions who chose Program A under the 'save' and 'die' conditions. Do we see the same pattern that Kahneman described?**


```{r}
bias_A <- bias_data %>% 
  group_by(rare_disease_cond) %>%
  summarise(prog_a = mean(rare_disease_prog == "Program A"))
bias_A
```

After observing the data collected from our class' Canvas responses, we see that when the question was framed in a "save" tone, 66.7% of respondents chose Program A. However, when the question was framed in a "die" tone, only 34.9% of respondents chose Program A. Though Program A offered the same exact logical function, the difference in proportions of students who chose Program A under "save" and "die" conditions is 31.8%. Evidently, we do see the same pattern that Kahneman described. When facing decision-making, losses tend to loom larger than gains for people. So when Program A is framed as a "save" situation, people were much more likely to choose the safe option. When framed as a "die" situation, people show their loss-aversion tendencies and they choose Program A 31.8% less of the time.


## Question 2
Now let's move on to the Linda problem. As we read in Kahneman (2003), answers to this problem tend to exhibit a pattern called a "conjunction fallacy" whereby respondents overrate the probability that Linda is a bank teller \textit{and} a feminist rather than just a bank teller. From probability theory, we know that the conjunction of two events A and B can't be more probable than either of the events occurring by itself; that is, $P(A) \ge P(A \wedge B)$ and $P(B) \ge P(A \wedge B)$\footnote{The symbol $\wedge$ is used in logical expressions to mean "AND". If there are two conditions, A and B, then $A \wedge B$ is true only when both A and B are separately true. The expression $P(A) \ge P(A \wedge B)$ is therefore interpreted as: "The probability A is true is greater than or equal to the probability that both A and B are true.}.

**What proportion of the class answered this question correctly? Why do you think people tend to choose the wrong option?**

```{r}
linda_correct <- bias_data %>%
  group_by(linda) %>%
  summarise(count = n(), prop = n() / 85)

linda_correct
```
70.59% of the class answered this question correctly. While the majority of our class was able to choose the right answer, many people in general tend to choose the wrong option. This occurs because many people think that given information about someone, the information makes something more likely about them. When we know that Linda is interested in social activism, we think it is not surprising for her to be a feminist. Most people, however, are not aware of the probability principles of the Linda question -- or they simply ignore the principle because the seemingly logical connection between what we know about Linda and what could be true is too convincing in the moment.

## Question 3

**What attributes of the respondents do you think might affect how they answered the Linda problem and why? Using the data, see if your hypothesis is correct.**
```{r}
linda_cab <- bias_data %>% 
  group_by(linda) %>%
  summarise(count = n(), cab_avg_guess = mean(cab))
linda_cab

linda_cab_T <- bias_data %>% 
  group_by(ints = cut_width(cab, width = .10, boundary = 0)) %>%
  summarise(T = mean(linda == "teller"))
linda_cab_T

linda_cab_TaF <- bias_data %>% 
  group_by(ints = cut_width(cab, width = .10, boundary = 0)) %>%
  summarise(TaF = mean(linda == "teller and feminist"))
linda_cab_TaF
```

```{r}
CrossTable(x = bias_data$linda, y = bias_data$college_stats, prop.r = FALSE, prop.c = TRUE, prop.t = FALSE, prop.chisq = FALSE)

ggplot(bias_data, aes(x = bias_data$cab, y = bias_data$linda)) +
    geom_vline(aes(xintercept = .413), col = "navy") + 
    geom_point()

ggplot(data = bias_data, mapping = aes(x = bias_data$cab, fill = bias_data$linda)) + 
  geom_vline(aes(xintercept = .413), col = "navy") + 
  geom_bar()
```
```{r}

CrossTable(x = bias_data$linda, y = bias_data$gender, prop.r = FALSE, prop.c = TRUE, prop.t = FALSE, prop.chisq = FALSE)
```
```{r}
CrossTable(x = bias_data$linda, y = bias_data$year, prop.r = FALSE, prop.c = TRUE, prop.t = FALSE, prop.chisq = FALSE)
```

College statistic education, age, responses to the cab question could correlate to students' answers to the Linda question. 

## Question 4: Data Science Question
Now we will take a look at the taxi cab problem. This problem, originally posed by Tversky and Kahneman in 1977, is intended to demonstrate what they call a "base rate fallacy". To refresh your memory, here is the text of the problem, as you saw it on the survey last week:

\begin{quote}
  A cab was involved in a hit and run accident at night. Two cab companies, the Green and the Blue, operate in the city. 85% of the cabs in the city are Green and 15% are Blue.
  
  A witness identified the cab as Blue. The court tested the reliability of the witness under the same circumstances that existed on the night of the accident and concluded that the witness correctly identified each one of the two colours 80% of the time and failed 20% of the time.
  
  What is the probability that the cab involved in the accident was Blue rather than Green knowing that this witness identified it as Blue?
\end{quote}

The most common answer to this problem is .8. This corresponds to the reliability of the witness, without regard for the base rate at which Blue cabs can be found relative to Green cabs. In other words, respondents tend to disregard the base rate when estimating the probability the cab was Blue.

```{r}
ggplot(data = bias_data, aes(x = cab)) +
  geom_histogram(binwidth = 0.05) + 
  geom_vline(aes(xintercept = .8), col = "red") +
  labs(title = "Taxi Cab Student Responses",
       x = "P(Blue | Identified as Blue)",
       y =  "Number of Student Guesses")
```


**What is the true probability the cab was Blue? Visualize the distribution of the guesses in the class using a histogram. What was the most common guess in the class?**

p(blue car | blue ID) = p(blue ID | blue car) * p(blue car) / p(blue ID)

p(blue ID) = (p(blue ID | blue car) * p(blue car)) + (p(blue ID | green car) * p(green car)) = (0.8 * 0.15) + (0.2 * 0.85) 

p = 0.8 * 0.15 / 0.1 = ~0.413

# Part 2: Political Faces

Now you will investigate some of the data used in Atkinson et al. (2009). These data cover Senate candidates from 1992-2006 and include face ratings, partisanship, incumbent status, and other variables. 

**Data Details:**

* File Name: \texttt{senate\_data.csv}

* Source: These data are condensed and adapted from the [replication data](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/RSI8NR) for Atkinson et al. (2009).

Variable Name         | Variable Description
--------------------- | --------------------------------------
\texttt{cook}         | The assessment of the Senate race from the Cook Political Report in the year prior to the election
\texttt{year}         | The year of the election
\texttt{state}        | The state in which the candidate was running
\texttt{face\_rating}  | The normalized rating of the candidate's perceived competence based on an image of the face
\texttt{incumbent}    | An indicator variable for whether the candidate was an incumbent
\texttt{candidate}    | The candidate's name
\texttt{party}        | The candidate's political party
\texttt{tossup}       | An indicator variable for whether the race was one of two "tossup" categories according to Cook
\texttt{jpg}         | A unique identifier for the photo of the candidate

As before, make sure you replace "file_name_here_2.csv" with the name of the file.

```{r faces, message=FALSE}
face_data <- read_csv("senate_data.csv")
```

As an example of how you might write your own code to analyze these data, let's take a look at whether there was a difference in the perceived competence of Democratic and Republican candidates' faces. We can examine this question graphically using a density plot.

```{r}
# make density plot of perceived competence by party
ggplot(data = face_data, aes(x = face_rating, color = party)) + # note that by setting color = party, 
  geom_density()                                                # the face ratings of each party will be 
                                                                # displayed in different colors
```

We can also consider this statistically using a t-test for whether or not the mean face ratings are significantly different across parties.

```{r}
# conduct a t-test of difference-in-means
difference_in_means(face_rating ~ party, data = face_data)
```

Neither the graphical nor the statistical approaches suggest a significant difference in perceived competence of candidate faces by party.

## Question 5
**Do the data suggest a significant difference between perceived competence of incumbent vs. non-incumbent candidate faces? How do your findings relate to the results and theory of Atkinson et al. (2009)?**

## Question 6
**Do the data suggest a significant difference between perceived competence of non-incumbent candidate faces in tossup vs. non-tossup races? What might explain any similarities or differences between these results and those from the previous question? How do your findings relate to the results and theory of Atkinson et al. (2009)?**

## Question 7: Data Science Question
Atkinson et al. (2009, 236) suggest that "...incumbents from the most competitive districts would have higher facial quality than incumbents from the most safe incument districts due to the selection process of better faces to competitive districts, inducing a negative relationship between incumbent face and incumbent vote." **Do the data support the idea that seat safety is negatively correlated with incumbent facial quality? Make a plot to visualize this relationship.** Note that this question may require you to define at least one new variable.

## Question 8
**Is there something else interesting or informative that you could explore using either of these datasets? If so, run it by a TF and try it out here.**